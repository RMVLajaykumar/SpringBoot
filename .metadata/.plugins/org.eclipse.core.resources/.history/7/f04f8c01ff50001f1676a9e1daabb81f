package com.monocept.app.service;

import java.util.ArrayList;
import java.util.List;

import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;


import com.monocept.app.dto.BlogDTO;
import com.monocept.app.entity.Blog;

import com.monocept.app.exception.BlogNotFoundException;

import com.monocept.app.repository.BlogRepository;
import com.monocept.app.util.PagedResponse;

@Service
public class BlogServiceImpl implements BlogService {
	private BlogRepository blogRepository;
	

	public BlogServiceImpl(BlogRepository blogRepository) {
		super();
		this.blogRepository = blogRepository;
	}



	


	private List<BlogDTO> convertBlogToBlogDTO(List<Blog> content) {
		List<BlogDTO> blogsDTO = new ArrayList();
		for(Blog blog:content) {
			BlogDTO blogDTO=new BlogDTO();
			blogDTO.setId(blog.getId());
			blogDTO.setTitle(blog.getTitle());
			blogDTO.setCategory(blog.getCategory());
			blogDTO.setData(blog.getData());
			blogDTO.setPublishedDate(blog.getPublishedDate());
			blogDTO.setPublished(blog.isPublished());
			blogDTO.setComments(blog.getComment());
			blogsDTO.add(blogDTO);
		}
		return blogsDTO;
	}

	

	@Override
	public PagedResponse<BlogDTO> getAllBlog(int page, int size, String sortBy, String direction) {
		Sort sort = Sort.by(sortBy);
		if (direction.equalsIgnoreCase(Sort.Direction.DESC.name())) {
			sort = sort.descending();
		} else {
			sort = sort.ascending();
		}
		Pageable pageable = PageRequest.of(page, size, sort);
		Page<Blog> blogPage = blogRepository.findAll(pageable);
		List<BlogDTO> blogDTO = convertBlogToBlogDTO(blogPage.getContent());
		return new PagedResponse<BlogDTO>(blogDTO, blogPage.getNumber(), blogPage.getSize(),
				blogPage.getTotalElements(), blogPage.getTotalPages(), blogPage.isLast());

	}






	@Override
	public Blog getBlogById(int id) {
			return blogRepository.findById(id).orElse(null);
		}



	
	
}
