package com.monocept.app.service;

import java.util.ArrayList;
import java.util.List;

import org.springframework.stereotype.Service;

import com.monocept.app.Dto.CourseResponseDTO;
import com.monocept.app.Dto.StudentResponseDTO;
import com.monocept.app.entity.Course;
import com.monocept.app.entity.Student;
import com.monocept.app.repository.CourseRepository;
import com.monocept.app.repository.StudentRepository;

import jakarta.validation.Valid;



@Service
public class StudentCourseServiceImpl implements StudentCourseService{
	private StudentRepository studentRepository;
	private CourseRepository courseRepository;
	
	
	public StudentCourseServiceImpl(StudentRepository studentRepository, CourseRepository courseRepository) {
		super();
		this.studentRepository = studentRepository;
		this.courseRepository = courseRepository;
	}


	@Override
	public StudentResponseDTO addStudent(@Valid Student student) {
		return convertStudentToStudentResponseDTO(studentRepository.save(student));

	}


	private StudentResponseDTO convertStudentToStudentResponseDTO(Student student) {
		
		StudentResponseDTO studentDTO = new StudentResponseDTO();
        studentDTO.setId(student.getId());
        studentDTO.setStudentName(student.getName());
        
        List<CourseResponseDTO> courses = new ArrayList<>();
        for (Course c : student.getCourses()) {
            CourseResponseDTO courseDTO = new CourseResponseDTO();
            courseDTO.setId(c.getId());
            courseDTO.setTitle(c.getTitle());
            courses.add(courseDTO);
        }
        studentDTO.setCourses(courses);
		return studentDTO;
	}


	


	@Override
	public List<StudentResponseDTO> getStudents() {
	
		List<Student> students = studentRepository.findAll();

		return convertStudentToStudentResponseDTO(students);
	}


	@Override
	public StudentResponseDTO getStudentById(long id) {
		Student student = studentRepository.findById(id).orElse(null);
		return convertStudentToStudentResponseDTO(student);

		

		
	}


	private List<StudentResponseDTO> convertStudentToStudentResponseDTO(List<Student> students) {
		  List<StudentResponseDTO> studentsDTO = new ArrayList<>();
		    for (Student s : students) {
		        StudentResponseDTO studentDTO = new StudentResponseDTO();
		        studentDTO.setId(s.getId());
		        studentDTO.setStudentName(s.getName());
		        
		        List<CourseResponseDTO> courses = new ArrayList<>();
		        for (Course c : s.getCourses()) {
		            CourseResponseDTO courseResponseDTO = new CourseResponseDTO();
		            courseResponseDTO.setId(c.getId());
		            courseResponseDTO.setTitle(c.getTitle());
		            courses.add(courseResponseDTO);
		        }
		        studentDTO.setCourses(courses);;
		        studentsDTO.add(studentDTO);
		        
		    }
		    return studentsDTO;
		}

	


	@Override
	public String deleteStudentById(long id) {
		Student student = studentRepository.findById(id).orElse(null);
		if(student==null) {
			return "No Student Found";
		}
		studentRepository.delete(student);
		return "Deleted Succesfully";

	}


	@Override
	public CourseResponseDTO addCourse(@Valid Course course) {
		return convertCourseToCourseDTO(courseRepository.save(course));

	}


	private CourseResponseDTO convertCourseToCourseDTO(Course course) {
		CourseResponseDTO courseResponseDTO=new CourseResponseDTO();
		courseResponseDTO.setId(course.getId());
		courseResponseDTO.setTitle(course.getTitle());
		List<StudentResponseDTO> students=new ArrayList<StudentResponseDTO>();
		for(Student s:course.getStudents()) {
			StudentResponseDTO studentResponseDTO=new StudentResponseDTO();
			studentResponseDTO.setId(s.getId());
			studentResponseDTO.setStudentName(s.getName());
			students.add(studentResponseDTO);
		}
		courseResponseDTO.setStudents(students);
		return courseResponseDTO;
	

	}


	@Override
	public List<CourseResponseDTO> getCourses() {
		// TODO Auto-generated method stub
		return null;
	}


	@Override
	public CourseResponseDTO geCourseById(long id) {
		// TODO Auto-generated method stub
		return null;
	}


	@Override
	public void deleteCourseById(long id) {
		// TODO Auto-generated method stub
		
	}


	@Override
	public CourseResponseDTO addCourseToStudent(long studentId, long courseId) {
		// TODO Auto-generated method stub
		return null;
	}


	@Override
	public CourseResponseDTO deleteCourseToStudent(long studentId, long courseId) {
		// TODO Auto-generated method stub
		return null;
	}


	
}